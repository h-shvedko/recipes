window.onload = function () {
/**
 *
 * @type {HTMLElement}
 */
let formElement = document.getElementById('form');

/**
 *
 * @type {HTMLElement}
 */
let menuCalculate = document.getElementById('menu-calculate');

/**
 *
 * @type {Element}
 */
let modal = document.querySelector('.modal');

/**
 *
 * @type {Element}
 */
let lightbox = document.querySelector('.lightbox');

/**
 *
 * @type {Element}
 */
let closeModalButton = document.querySelector('.hide-modal');

/**
 *
 * @type {number}
 */
let kalories = 0;

/**
 *
 * @type {number}
 */
let fruestuckKalorien = 0;

/**
 *
 * @type {number}
 */
let mittagessenKalorien = 0;

/**
 *
 * @type {number}
 */
let abendessenKalorien = 0;

/**
 *
 */
let recipes;

/**
 *
 * @type {Array}
 */
let usedNumbers = [];

/**
 *
 */
let menuItems;

/**
 *
 * @type {HTMLElement}
 */
let listGenerate = document.getElementById('list-generation');

/**
 *
 * @type {HTMLElement}
 */
let menuPrint = document.getElementById('menu-print');

/**
 *
 * @type {HTMLElement}
 */
let listePrint = document.getElementById('liste-print');

/**
 *
 * @type {Array}
 */
let menuObject = [];

let formErrors = [];

/**
 *
 * @type {string}
 */
const WEIBLICH_GESCHLECHT = 'weiblich';

/**
 *
 * @type {string}
 */
const MAENLICH_GESCHLECHT = 'maennlich';

/**
 *
 * @type {number}
 */
const ERGEBNIS_ZUNEHMEN = 1;

/**
 *
 * @type {number}
 */
const ERGEBNIS_ABNEHMEN = 2;

/**
 *
 * @type {number}
 */
const ERGEBNIS_BLEIBEN = 3;

/**
 *
 * @type {string}
 */
const AKTIVITAT_MANGEL = '1';

/**
 *
 * @type {string}
 */
const AKTIVITAT_MASSIGE = '2';

/**
 *
 * @type {string}
 */
const AKTIVITAT_MITTLERE = '3';

/**
 *
 * @type {string}
 */
const AKTIVITAT_SEHR_AKTIVE = '4';

/**
 *
 * @type {string}
 */
const AKTIVITAT_SPORTLER = '5';

/**
 *
 * @type {number}
 */
const FRUESTUEK_PROZENT = 30;

/**
 *
 * @type {number}
 */
const MITTAGESSEN_PROZENT = 50;

/**
 *
 * @type {number}
 */
const ABENDESSEN_PROZENT = 20;

/**
 *
 * @type {number}
 */
const MENU_300 = 300;

/**
 *
 * @type {number}
 */
const MENU_500 = 500;

/**
 *
 * @type {number}
 */
const MENU_800 = 800;

/**
 *
 * @type {string}
 */
const FRUESTUEK_NAME = 'fruestuek';

/**
 *
 * @type {string}
 */
const MITTAGESSEN_NAME = 'mittagessen';

/**
 *
 * @type {string}
 */
const ABENDESSEN_NAME = 'abendessen';

if (formElement) {
    /**
     *
     */
    formElement.addEventListener('reset', function (event) {
        let ergebnis = document.getElementsByClassName('ergebnis-container')[0];
        let speiseplanAbgrage = document.getElementsByClassName('speiseplan-anfrage')[0];
        let speiseplan = document.getElementsByClassName('menu-container')[0];
        let listErgebnis = document.querySelector('.list-of-products');

        if (ergebnis) {
            ergebnis.style.display = 'none';
            speiseplanAbgrage.style.display = 'none';
            speiseplan.style.display = 'none';
            listErgebnis.style.display = 'none';
        }
    });

    /**
     *
     */
    formElement.addEventListener('submit', function (event) {
        event.preventDefault();
        event.stopPropagation();
        let formValid = validateForm(formElement);
        let formData = prepareFormData(event.target.elements);

        if (formValid) {
            kalories = calculateCalories(formData);
        }

        let ergebnissKalorien = document.querySelector('.ergebnis-container') || null;
        let speiseplanAbgrage = document.querySelector('.speiseplan-anfrage') || null;

        if (ergebnissKalorien !== null) {
            let name = formData['vorname'];

            if (kalories < 1200) {
                ergebnissKalorien.getElementsByClassName('result-text')[0].innerHTML = name + ', Sie sollen mindestens <strong>1200</strong> Kalorien pro Tag essen! Aber villeicht haben Sie etwas falsch eingegeben.'
            } else {
                ergebnissKalorien.getElementsByClassName('result-text')[0].innerHTML = name + ', Sie sollen maximal <strong>' + kalories + '</strong> Kalorien pro Tag essen!'
            }

            ergebnissKalorien.style.display = 'block';
            speiseplanAbgrage.style.display = 'block';
        }

        return false;
    });
}

/**
 * Form validation method
 * @param form - form javascript object
 * @returns {boolean}
 */
validateForm = function (form) {
    let res = true;

    return res;
};

/**
 *
 * @param aktivitaet
 * @returns {number}
 */
getAktivitaet = function (aktivitaet) {

    switch (aktivitaet) {
        case AKTIVITAT_MANGEL:
            return 1.2;
        case AKTIVITAT_MASSIGE:
            return 1.375;
        case AKTIVITAT_MITTLERE:
            return 1.55;
        case AKTIVITAT_SEHR_AKTIVE:
            return 1.725;
        case AKTIVITAT_SPORTLER:
            return 1.9;
    }
};

/**
 * Calculation of calories
 * @param formData
 * @returns {number}
 */
calculateCalories = function (formData) {
    let res = 0,
        bmr = 0,
        a, b, c, d, amr;
    let geschlecht = formData['geschlecht'] || null;
    let gewicht = formData['gewicht'] || 0;
    let alter = formData['alter'] || 0;
    let grosse = formData['grosse'] || 0;
    let aktivitaet = formData['aktivitaet'] || 0;
    let ergebnis = parseInt(formData['ergebnis']) || 0;

    if (geschlecht !== null) {
        if (geschlecht === WEIBLICH_GESCHLECHT) {
            a = 447.593;
            b = 9.247;
            c = 3.098;
            d = 4.33;
        } else {
            a = 88.362;
            b = 13.397;
            c = 4.799;
            d = 5.677;
        }

        let koeff = 1;
        switch (ergebnis) {
            case ERGEBNIS_ZUNEHMEN:
                koeff = 1.2;
                break;
            case ERGEBNIS_ABNEHMEN:
                koeff = 0.8;
                break;
        }

        bmr = (a + b * gewicht + c * grosse - d * alter) * koeff;
        amr = getAktivitaet(aktivitaet);

        res = Math.round(bmr * amr);
    }

    return res;
};

/**
 * Preparing data drom form
 * @param formElements
 * @returns {Array}
 */
prepareFormData = function (formElements) {
    let data = [];

    if (formElements) {
        let dataName, dataValue;

        for (let i = 0; i < formElements.length; i++) {
            if (formElements[i].hasAttribute('name')) {
                if (formElements[i].hasAttribute('type') && formElements[i].getAttribute('type') === 'radio'
                    && formElements[i].checked) {
                    dataName = formElements[i].getAttribute('name');
                    dataValue = formElements[i].value;
                } else if (formElements[i].hasAttribute('type') && formElements[i].getAttribute('type') !== 'radio' && formElements[i].tagName !== 'select') {
                    dataName = formElements[i].getAttribute('name');
                    dataValue = formElements[i].value;
                } else if (formElements[i].tagName.toLocaleLowerCase() === 'select') {
                    dataValue = formElements[i].options[formElements[i].selectedIndex].value;
                    dataName = formElements[i].getAttribute('name');
                }
                data[dataName] = dataValue;
            }
        }
    }

    return data;
};

/**
 * Get content from recipes files
 */
loadGerichten = function () {
    let xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function () {
        if (this.readyState === 4 && this.status === 200) {
            recipes = JSON.parse(this.responseText);
        }
    };
    xhttp.open("GET", "./recipes.json", false);
    xhttp.send();
};

/**
 * Generates menu table
 */
generateMenu = function () {
    fruestuckKalorien = Math.floor(kalories * FRUESTUEK_PROZENT / 100);
    mittagessenKalorien = Math.floor(kalories * MITTAGESSEN_PROZENT / 100);
    abendessenKalorien = Math.floor(kalories * ABENDESSEN_PROZENT / 100);

    let ergebnisContainer = document.getElementsByClassName('ergebnis-container')[0];
    let menuAnfrage = document.getElementsByClassName('speiseplan-anfrage')[0];

    if (ergebnisContainer) {
        let tage = menuAnfrage.querySelectorAll('.tage');
        let nummerTage = 3;

        if (tage) {
            tage.forEach(function (elem) {
                if (elem.checked) {
                    nummerTage = elem.value
                }
            });
        }
        let menuObject = getMenuObject(nummerTage);

        let htmlElement = generateHtmlForMenu(menuObject);
        let htmlElementForPrint = generateHtmlForPrintMenu(menuObject);
        let tableMenu = document.getElementsByClassName('menu-container')[0];

        if(tableMenu){
            tableMenu.style.display = 'block';
            let ergebnis = tableMenu.querySelector('.result-text.display');
            if(ergebnis){
                ergebnis.innerHTML = htmlElement.outerHTML;
                ergebnis.scrollIntoView({block: "start", behavior: "smooth"});
                addEventListenrsForMenus();
            }

            let ergebnisPrint = tableMenu.querySelector('.result-text.print');
            if(ergebnisPrint){
                ergebnisPrint.innerHTML = htmlElementForPrint.outerHTML;
            }
        }
    }
};

/**
 *
 * @param nummerTage
 */
getMenuObject = function (nummerTage) {
    let res = [];

    for (let i = 1; i <= nummerTage; i++) {
        let tmpTag = [];
        let tmpRes = [];
        for (let j = 1; j <= 3; j++) {
            let recipeObject = recipes;
            let nummerVonGerichte = recipeObject.dishes.length - 1;
            let gerichteNummer = getRandomGerichtNummer(1, nummerVonGerichte);

            tmpTag[j] = recipeObject.dishes[gerichteNummer];
        }

        usedNumbers = [];
        tmpRes['fruestueck'] = tmpTag[1];
        tmpRes['mittag'] = tmpTag[2];
        tmpRes['abend'] = tmpTag[3];

        res.push(tmpRes);
    }

    menuObject = res;

    return res;
};

/**
 *
 * @param min
 * @param max
 * @returns {*}
 */
getRandomNummer = function (min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min + 1)) + min;
};

/**
 *
 * @param min
 * @param max
 * @returns {*}
 */
getRandomGerichtNummer = function (min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    let nummer = Math.floor(Math.random() * (max - min + 1)) + min;

    if(usedNumbers.includes(nummer)){
        nummer = getRandomGerichtNummer(min, max);
    }

    usedNumbers.push(nummer);

    return nummer;
};

if (menuCalculate) {
    /**
     *
     */
    menuCalculate.addEventListener('click', function (event) {
        event.preventDefault();
        event.stopPropagation();

        loadGerichten();

        generateMenu();

        return false;
    });
}

/**
 *
 * @param gerichtObject - рецепт одного блюда берется из json
 * @param type
 * @returns {number}
 */
window.getGerichteWeight = function (gerichtObject, type) {
    let weight = 0;

    /**
     * подсчет коефициента на каждый прием пищи
     * кол-во каллорий на завтрак = дневная норма каллорий умноженная на процент необходимый для завтрака (30%)
     */
    let frueschtuek = kalories * FRUESTUEK_PROZENT / 100;
    let mittag = kalories * MITTAGESSEN_PROZENT / 100;
    let abend = kalories * ABENDESSEN_PROZENT / 100;

    //Кол-во каллорий на одну порцию
    let kaloriesProPorzionGramm = gerichtObject.calories;

    //рассчитываем коэфициент для каждого приема пищи, для корректировки веса одной порции блюда
    let koefficientFruestuek = frueschtuek / kaloriesProPorzionGramm;
    let koefficientMittag = mittag / kaloriesProPorzionGramm;
    let koefficientAbend = abend / kaloriesProPorzionGramm;

    //расчитывем вес одной порции блюда в зависимости от коэфициента веса и время приема пищи
    switch (type) {
        case FRUESTUEK_NAME:
            weight = Math.round(gerichtObject.weight * koefficientFruestuek);
            break;
        case ABENDESSEN_NAME:
            weight = Math.round(gerichtObject.weight * koefficientAbend);
            break;
        case MITTAGESSEN_NAME:
            weight = Math.round(gerichtObject.weight * koefficientMittag);
            break;
    }

    return weight;
};


/**
 * Open modal window
 */
window.openModal = function () {
    if (modal !== null) {
        modal.style.display = 'block';
    }
};

/**
 * Close modal window
 */
window.closeModal = function () {
    if (modal !== null) {
        modal.style.display = 'none';
    }
};

/**
 * Show lightbox
 */
window.showLightbox = function () {
    if (lightbox !== null) {
        lightbox.style.display = 'block';
    }
};

/**
 * Hide lightbox
 */
window.hideLightbox = function () {
    if (lightbox !== null) {
        lightbox.style.display = 'none';
    }
};

if (lightbox !== null) {
    /**
     *
     */
    lightbox.addEventListener('click', function (event) {
       closeModal();
       hideLightbox();
    });
}


if (closeModalButton !== null) {
    /**
     *
     */
    closeModalButton.addEventListener('click', function (event) {
        closeModal();
        hideLightbox();
    });
}

/**
 *
 * @param photoId
 * @returns {HTMLElement}
 */
window.createImg = function (photoId) {
    let image = document.createElement('img');
    image.setAttribute('src', './img/image' + photoId + '.jpg');
    image.setAttribute('alt', 'image' + photoId);
    image.classList.add('img-fluid');
    return image;
};

/**
 *
 * @returns {HTMLElement}
 * @param text
 */
window.createHeadline = function (text) {
    let headline = document.createElement('h4');
    headline.innerHTML = text;
    return headline;
};

/**
 *
 * @returns {HTMLElement}
 * @param text
 */
window.createHeadlineH2 = function (text) {
    let headline = document.createElement('h2');
    let span = document.createElement('span');
    span.innerHTML = text;
    headline.appendChild(span);
    headline.classList.add('headline');
    headline.classList.add('headline--dotted');
    return headline;
};

/**
 *
 * @returns {HTMLElement}
 * @param text
 */
window.createText = function (text) {
    let textTag = document.createElement('p');
    textTag.innerHTML = text;
    return textTag;
};

/**
 *
 * @param object - рецепт одного блюда берется из json
 * @returns {HTMLElement}
 */
window.createBeschreibung = function (object, isPrint) {
    let popover = document.createElement('div');
    let popoverHeader = document.createElement('h3');
    let popoverBody = document.createElement('div');
    let ingredientElement = document.createElement('div');
    let ingredients = object.ingredients;
    let ingredientsHtml = '';
    let image = createImg(object.photoId);

    if(!isPrint){
        popover.classList.add("popover");
        popover.classList.add("fade");
    } else {
        popover.classList.add("popover-print");
    }

    popoverHeader.classList.add('popover-header');

    popoverBody.classList.add('popover-body');

    popover.appendChild(popoverHeader);
    popover.appendChild(popoverBody);

    popoverHeader.innerText = object.name;

    ingredientElement.classList.add('mt-3');
    ingredientElement.classList.add('mb-3');
    ingredientElement.classList.add('ingredients');
    ingredientElement.classList.add('text-right');

    let zutatenElement = createText("Zutaten");
    zutatenElement.classList.add('popover-headline');

    ingredientsHtml += zutatenElement.outerHTML;

    if (ingredients.length > 0) {
        for (let i = 0; i < ingredients.length; i++) {
            let measure = '';
            if (ingredients[i].measure !== 'n/a') {
                measure = ingredients[i].measure;
            }

            let quantity = '';
            if (ingredients[i].quantity !== 'n/a') {
                quantity = ingredients[i].quantity;
            }
            ingredientsHtml += createText(quantity + " " + measure + " " + ingredients[i].name).outerHTML;
        }
    }

    ingredientElement.innerHTML = ingredientsHtml;

    let zubereitungElement = createText("Zubereitung");
    zubereitungElement.classList.add('popover-headline');

    //object.process - процесс в рецепте, уже заисанный в HTML
    popoverBody.innerHTML = image.outerHTML + ingredientElement.outerHTML + zubereitungElement.outerHTML + object.process;

    return popover;
};

/**
 *
 * @param menuObject
 * @returns {HTMLElement}
 */
window.generateHtmlForMenu = function (menuObject) {
    let block = document.createElement('div');
    if (menuObject.length > 0) {

        let blockCol = document.createElement('div');
        let table = document.createElement('table');

        block.classList.add('row');
        block.classList.add('table');

        blockCol.classList.add('col');
        blockCol.classList.add('col-12');

        table.classList.add('table');
        table.classList.add('w-100');

        block.appendChild(blockCol);
        blockCol.appendChild(table);

        let thead = document.createElement('thead');
        let tr = document.createElement('tr');

        thead.appendChild(tr);

        let theadCell1 = tr.insertCell(0);
        theadCell1.innerHTML = "";

        let theadCell2 = tr.insertCell(1);
        theadCell2.innerHTML = "Fruhstück";
        theadCell2.classList.add('font-weight-bold');
        theadCell2.classList.add('text-center');

        let theadCell3 = tr.insertCell(2);
        theadCell3.innerHTML = "Mittagessen";
        theadCell3.classList.add('font-weight-bold');
        theadCell3.classList.add('text-center');

        let theadCell4 = tr.insertCell(3);
        theadCell4.innerHTML = "Abensessen";
        theadCell4.classList.add('font-weight-bold');
        theadCell4.classList.add('text-center');

        table.appendChild(thead);

        let tbody = document.createElement('tbody');

        let trBody;
        for (let i = 0; i < menuObject.length; i++) {
            let tag = i + 1;

            trBody = document.createElement('tr');

            let cell0 = trBody.insertCell(0);
            let cell1 = trBody.insertCell(1);
            let cell2 = trBody.insertCell(2);
            let cell3 = trBody.insertCell(3);

            let image1 = createImg(menuObject[i].fruestueck.photoId);
            let image2 = createImg(menuObject[i].mittag.photoId);
            let image3 = createImg(menuObject[i].abend.photoId);

            let headline1 = createHeadline(menuObject[i].fruestueck.name);
            let headline2 = createHeadline(menuObject[i].mittag.name);
            let headline3 = createHeadline(menuObject[i].abend.name);

            let weight1 = createText("<i class=\"fas fa-balance-scale\"></i> " + getGerichteWeight(menuObject[i].fruestueck, FRUESTUEK_NAME) + " g");
            let weight2 = createText("<i class=\"fas fa-balance-scale\"></i> " + getGerichteWeight(menuObject[i].mittag, MITTAGESSEN_NAME) + " g");
            let weight3 = createText("<i class=\"fas fa-balance-scale\"></i> " + getGerichteWeight(menuObject[i].abend, ABENDESSEN_NAME) + " g");

            let kallorien1 = createText("<i class=\"fas fa-fire-alt\"></i> " + menuObject[i].fruestueck.relative_calories + " kcal pro 100 g");
            let kallorien2 = createText("<i class=\"fas fa-fire-alt\"></i> " + menuObject[i].mittag.relative_calories + " kcal pro 100 g");
            let kallorien3 = createText("<i class=\"fas fa-fire-alt\"></i> " + menuObject[i].abend.relative_calories + " kcal pro 100 g");

            let zeit1 = createText("<i class=\"fas fa-hourglass-start\"></i> " + menuObject[i].fruestueck.time + " min");
            let zeit2 = createText("<i class=\"fas fa-hourglass-start\"></i> " + menuObject[i].mittag.time + " min");
            let zeit3 = createText("<i class=\"fas fa-hourglass-start\"></i> " + menuObject[i].abend.time + " min");

            let process1 = createBeschreibung(menuObject[i].fruestueck, false);
            let process2 = createBeschreibung(menuObject[i].mittag, false);
            let process3 = createBeschreibung(menuObject[i].abend, false);

            cell0.innerHTML = "Tag " + (tag);
            cell0.classList.add('w-10');
            cell0.classList.add('font-weight-bold');
            cell0.classList.add('text-center');

            cell1.innerHTML = image1.outerHTML + headline1.outerHTML + weight1.outerHTML + kallorien1.outerHTML + zeit1.outerHTML + process1.outerHTML;
            cell1.classList.add('w-30');
            cell1.classList.add('menu-item');
            cell1.classList.add('fruestuek');

            cell2.innerHTML = image2.outerHTML + headline2.outerHTML + weight2.outerHTML + kallorien2.outerHTML + zeit2.outerHTML + process2.outerHTML;
            cell2.classList.add('w-30');
            cell2.classList.add('menu-item');
            cell2.classList.add('mittag');

            cell3.innerHTML = image3.outerHTML + headline3.outerHTML + weight3.outerHTML + kallorien3.outerHTML + zeit3.outerHTML + process3.outerHTML;
            cell3.classList.add('w-30');
            cell3.classList.add('menu-item');
            cell3.classList.add('abend');

            tbody.appendChild(trBody);
        }

        table.appendChild(tbody);

    }


    return block;
};

/**
 *
 * @param menuObject
 * @returns {HTMLElement}
 */
window.generateHtmlForPrintMenu = function (menuObject) {
    let block = document.createElement('div');
    if (menuObject.length > 0) {

        let blockCol = document.createElement('div');
        let table = document.createElement('table');

        block.classList.add('row');
        block.classList.add('table');

        blockCol.classList.add('col');
        blockCol.classList.add('col-12');

        table.classList.add('table');
        table.classList.add('w-100');

        block.appendChild(blockCol);
        blockCol.appendChild(table);

        let tbody = document.createElement('tbody');

        let trBody;
        for (let i = 0; i < menuObject.length; i++) {
            let tag = i + 1;

            trBody = document.createElement('tr');

            let cell0 = trBody.insertCell(0);

            let innerTable = document.createElement('table');

            for(let zeitName in menuObject[i]){
                let innerTr = document.createElement('tr');
                let innerCell0 = innerTr.insertCell(0);
                let innerCell1 = innerTr.insertCell(1);

                let innerImage = createImg(menuObject[i][zeitName].photoId);
                let innerHeadline = createHeadline(menuObject[i][zeitName].name);
                let innerWeight = createText("<i class=\"fas fa-balance-scale\"></i> " + getGerichteWeight(menuObject[i][zeitName], zeitName) + " g");
                let innerKallorien = createText("<i class=\"fas fa-fire-alt\"></i> " + menuObject[i][zeitName].relative_calories + " kcal pro 100 g");
                let innerZeit = createText("<i class=\"fas fa-hourglass-start\"></i> " + menuObject[i][zeitName].time + " min");
                let innerProcess = createBeschreibung(menuObject[i][zeitName], true);

                let title = "Fruhstück";

                switch (zeitName) {
                    case "fruestueck":
                        title = 'Fruhstück';
                        break;
                    case "abend":
                        title = 'Abendessen';
                        break;
                    case "mittag":
                        title = 'Mittagessen';
                        break;
                }

                innerCell0.innerHTML = title + '<br>' + 'Tag ' + tag;
                innerCell0.classList.add('title-print');
                innerCell0.classList.add('font-weight-bold');
                innerCell0.classList.add('text-center');

                innerCell0.classList.add('w-20');
                innerCell1.innerHTML = innerImage.outerHTML + innerHeadline.outerHTML + innerWeight.outerHTML + innerKallorien.outerHTML + innerZeit.outerHTML + innerProcess.outerHTML;
                innerCell1.classList.add('w-80');
                innerCell1.classList.add('menu-item');
                innerCell1.classList.add('fruestuek');

                innerTable.appendChild(innerTr);
            }

            cell0.innerHTML = innerTable.outerHTML;


            tbody.appendChild(trBody);
        }

        table.appendChild(tbody);

    }


    return block;
};

/**
 *
 * @param event
 */
window.showBeschreibung = function (event) {
    let element = event.currentTarget;

    let popover = element.querySelector('.popover');

    if (popover) {
        popover.classList.add('show');
    }

    return true;
};

/**
 *
 * @param event
 */
window.hideBeschreibung = function (event) {
    let element = event.currentTarget;

    let popover = element.querySelector('.popover');

    if (popover) {
        popover.classList.remove('show');
    }

    return true;
};

/**
 *
 */
window.addEventListenrsForMenus = function () {
    let menuItems = document.querySelectorAll('.menu-item');

    if (menuItems) {
        menuItems.forEach(function (element) {
            element.addEventListener('mouseover', showBeschreibung);
            element.addEventListener('mouseleave', hideBeschreibung);
        })
    }
};

if (menuPrint) {
    menuPrint.addEventListener('click', function (event) {
        event.preventDefault();

        window.print();

        return false;
    });
}

if (listePrint) {
    listePrint.addEventListener('click', function (event) {
        event.preventDefault();

        document.querySelector('.menu-container').style.display = 'none';
        document.querySelector('#show-menu').style.display = 'block';
        window.print();

        return false;
    });
}

let menuShow = document.getElementById('show-menu');

if (menuShow) {
    menuShow.addEventListener('click', function (event) {
        event.preventDefault();

        document.querySelector('.menu-container').style.display = 'block';
        document.querySelector('#show-menu').style.display = 'none';

        return false;
    });
}

if (listGenerate) {
    listGenerate.addEventListener('click', function (event) {
        event.preventDefault();

        if (menuObject && menuObject.length > 0) {
            let fruestuek = [];
            let mittag = [];
            let abend = [];

            for (let i = 0; i < menuObject.length; i++) {
                fruestuek.push(menuObject[i].fruestueck);
                mittag.push(menuObject[i].mittag);
                abend.push(menuObject[i].abend);
            }

            let listWrapper = document.createElement('div');
            let listWrapperCol = document.createElement('div');

            listWrapper.classList.add('row');
            listWrapperCol.classList.add('col-12');

            listWrapper.appendChild(listWrapperCol);

            let tmpList;
            tmpList = fruestuek.concat(mittag);
            tmpList = tmpList.concat(abend);

            let listOfProducts;
            listOfProducts = getListOfProducts(tmpList);

            if (listOfProducts) {
                for (let name in listOfProducts) {
                    let quantity = listOfProducts[name]['quantity'] ? listOfProducts[name]['quantity'] : '';
                    let element = createText("<span class='mr-3 custom-control-input'></span>" + name + ": " + quantity + " " + listOfProducts[name]['measure']);
                    element.classList.add('custom-control');
                    listWrapperCol.appendChild(element);
                }

                let listErgebnis = document.querySelector('.list-of-products');

                if(listErgebnis){
                    let textContainer = listErgebnis.getElementsByClassName('result-text')[0];

                    if(textContainer){
                        textContainer.innerHTML = listWrapper.outerHTML;
                        listErgebnis.style.display = 'block';
                        listErgebnis.scrollIntoView({block: "start", behavior: "smooth"});
                    }
                }
            }
        }
        return false;
    });
}

/**
 *
 * @param object
 * @returns {Array}
 */
window.getListOfProducts = function (object) {
    let listOfProducts = [];
    if (object.length > 0) {
        for (let i = 0; i < object.length; i++) {
            if(object[i].ingredients && object[i].ingredients.length > 0){
                let ingredients = object[i].ingredients;
                for (let j = 0; j < ingredients.length; j++) {

                    if(ingredients[j]['name'] in listOfProducts){
                        listOfProducts[ingredients[j]['name']] = {
                            'quantity' : parseInt(ingredients[j]['quantity']) + parseInt(listOfProducts[ingredients[j]['name']]['quantity']),
                            'measure' : ingredients[j]['measure']
                        };
                    } else {
                        listOfProducts[ingredients[j]['name']] = {
                            'quantity' :  parseInt(ingredients[j]['quantity']),
                            'measure' : ingredients[j]['measure']
                        };
                    }
                }
            }
        }
    }

    return listOfProducts;
};

};
